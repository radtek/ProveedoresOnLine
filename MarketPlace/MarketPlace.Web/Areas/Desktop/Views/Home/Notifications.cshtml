@{
    ViewBag.Title = "Proveedores OnLine - Mis Notificaciones";
    Layout = MVC.Desktop.Shared.Views._Layout;
}

<div class="col-md-10 col-md-offset-2">

    @*ESTE ES EL ENVUELTO COMPLETO DE MENU LATERAL Y CONTENIDO*@
    <div class="POMPProviderGreatWrapper">
        @*ESTE ES QUE TRAE EL PARCIAL QUE PINTA EL MENU LATERAL*@

        <div class="POMPProviderDataWrapper" style="min-width: 1000px !important;">
            <label class="POMPSectionTitles">Mis Notificaciones</label>


            @if (MarketPlace.Models.General.SessionModel.NewNotifications)
            {
                if (MarketPlace.Models.General.SessionModel.ListNotifications != null)
                {
                    <table class="table table-hover">
                        <thead>
                        </thead>
                        <tbody>
                            @foreach (var Notification in MarketPlace.Models.General.SessionModel.ListNotifications.OrderByDescending(x => x.CreateDate))
                            {
                                var companyInfo = ProveedoresOnLine.Company.Controller.Company.CompanyGetBasicInfo(Notification.CompanyPublicId);

                                var NotificatioBody = Notification.ListNotificationInfo.SingleOrDefault(x => x.NotificationInfoType == 2008007) != null
                                    ? Notification.ListNotificationInfo.SingleOrDefault(x => x.NotificationInfoType == 2008007).LargeValue
                                    : "";

                                var logo = Notification.NotificationType == 2009001 // GeneralInfo
                                    ? MarketPlace.Models.General.InternalSettings.Instance[MarketPlace.Models.General.Constants.C_Settings_NotificationIconGeneralInfo].Value.Trim()
                                    : Notification.NotificationType == 2009002 //AdditionalInfo
                                    ? MarketPlace.Models.General.InternalSettings.Instance[MarketPlace.Models.General.Constants.C_Settings_NotificationIconAdditionalInfo].Value.Trim()
                                    : Notification.NotificationType == 2009003 //HSEQ
                                    ? MarketPlace.Models.General.InternalSettings.Instance[MarketPlace.Models.General.Constants.C_Settings_NotificationIconHSEQ].Value.Trim()
                                    : "";

                                if (companyInfo != null)
                                {
                                    logo = companyInfo.CompanyInfo.Where(y => y.ItemInfoType.ItemId == 203005).Select(y => y.Value).FirstOrDefault() != null
                                       ? companyInfo.CompanyInfo.Where(y => y.ItemInfoType.ItemId == 203005).Select(y => y.Value).FirstOrDefault()
                                      : logo;
                                }

                                var UrlRedirection = Notification.NotificationType == 2009001 // GeneralInfo
                                    ? MarketPlace.Models.General.InternalSettings.Instance[MarketPlace.Models.General.Constants.C_Settings_NotificationGeneralInfo_Mk].Value.Trim() + Notification.CompanyPublicId
                                    : Notification.NotificationType == 2009002 //AdditionalInfo
                                    ? MarketPlace.Models.General.InternalSettings.Instance[MarketPlace.Models.General.Constants.C_Settings_NotificationAdditionalInfo_MK].Value.Trim() + Notification.CompanyPublicId
                                    : Notification.NotificationType == 2009003 //HSEQ
                                    ? MarketPlace.Models.General.InternalSettings.Instance[MarketPlace.Models.General.Constants.C_Settings_NotificationHSEQ_MK].Value.Trim() + Notification.CompanyPublicId
                                    : "#";

                                var classLeido = Notification.State == 2013002 ? "background : #EFF5F5;" : "";
                                <tr style="@classLeido">
                                    <td>
                                        @Html.Raw(
                                                 Ajax.ActionLink(
                                                             "[replacetext]",
                                                             "ChangeStatusNotification",
                                                             "Home",
                                                             new
                                                             {
                                                                 idNotification = Notification.NotificationId
                                                             },
                                                             new AjaxOptions
                                                             {
                                                                 UpdateTargetId = "Notification",
                                                                 InsertionMode = InsertionMode.Replace,
                                                                 HttpMethod = "POST",
                                                                 OnBegin = "actualizaEstado('" + UrlRedirection + "', this)"
                                                             },
                                                             null)
                                                 .ToHtmlString()
                                                 .Replace("[replacetext]", "<img class=\"img img-circle\" style=\" width: 35px; height: 35px; margin-right: 10px;\" src=\"" + logo + "\" />" + Notification.Label + " - " + companyInfo.CompanyName + "<span class=\"pull-right text-muted small\">" + Notification.CreateDate.ToShortDateString() + " " + Notification.CreateDate.ToLongTimeString() + "</span><br><em class=\"small\" style=\"padding-left: 50px;\">" + NotificatioBody + "</em>"))
                                    </td>
                                </tr>
                            }
                        </tbody>

                    </table>
                }
            }
        </div>

    </div>
</div>
<script>
    function actualizaEstado(url, e) {
        $(e).closest('tr').css("background", '');
        window.open(url, '_blank');
    }

</script>